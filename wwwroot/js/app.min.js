!function(){"use strict";var e={isLoading:!0,visibleCards:{},selectedAirports:[],spinner:document.querySelector(".loader"),cardTemplate:document.querySelector(".cardTemplate"),container:document.querySelector(".main"),addDialog:document.querySelector(".dialog-container")};document.getElementById("butRefresh").addEventListener("click",function(){e.updateForecasts()}),document.getElementById("butAdd").addEventListener("click",function(){e.toggleAddDialog(!0)}),document.getElementById("butAddCity").addEventListener("click",function(){var t=document.getElementById("selectAirportToAdd").value.toUpperCase();""!=t&&(e.selectedAirports||(e.selectedAirports=[]),e.getForecast(t),e.selectedAirports.push({icao:t}),e.saveselectedAirports(),document.getElementById("selectAirportToAdd").value=""),e.toggleAddDialog(!1)}),document.getElementById("butAddCancel").addEventListener("click",function(){e.toggleAddDialog(!1)}),e.toggleAddDialog=function(t){t?e.addDialog.classList.add("dialog-container--visible"):e.addDialog.classList.remove("dialog-container--visible")},e.updateForecastCard=function(t){var r=new Date(t.created),o=t.met[0],n=t.info[0],a=e.visibleCards[o.loc];a||((a=e.cardTemplate.cloneNode(!0)).classList.remove("cardTemplate"),a.querySelector(".name").textContent=n.name,a.querySelector(".location").textContent=o.loc,a.removeAttribute("hidden"),e.container.appendChild(a),e.visibleCards[o.loc]=a);var i=a.querySelector(".card-last-updated"),c=i.textContent;if(!(c&&(c=new Date(c),r.getTime()<c.getTime()))){i.textContent=o.created;var d=o.metar.toString().slice(13);d.indexOf("SPECI")>=0&&(d=d.substring(d.indexOf("SPECI"),d.lenght));var s=o.taf.toString().slice(13);a.querySelector(".metar").textContent=d,a.querySelector(".taf").textContent=s,a.querySelector(".linkCharts").textContent="Charts",a.querySelector(".linkCharts").setAttribute("href","/Home/Charts?icao="+o.loc),a.querySelector(".linkNotam").textContent="Notam",a.querySelector(".linkNotam").setAttribute("href","/Home/Notam?icao="+o.loc),e.isLoading&&(e.spinner.setAttribute("hidden",!0),e.container.removeAttribute("hidden"),e.isLoading=!1)}},e.getForecast=function(t){var r="/Weather/"+t;"caches"in window&&caches.match(r).then(function(t){t&&t.json().then(function(t){var r=t;void 0==r.info[0].aeroCode?alert("Invalid Airport"):e.updateForecastCard(r)})});var o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE&&200===o.status){var t=JSON.parse(o.response);void 0==t.info[0].aeroCode?alert("Invalid Airport"):e.updateForecastCard(t)}},o.open("GET",r),o.send()},e.updateForecasts=function(){Object.keys(e.visibleCards).forEach(function(t){e.getForecast(t)})},e.saveselectedAirports=function(){var t=JSON.stringify(e.selectedAirports);localStorage.selectedAirports=t},e.selectedAirports=localStorage.selectedAirports,e.selectedAirports&&(e.selectedAirports=JSON.parse(e.selectedAirports),e.selectedAirports.forEach(function(t){e.getForecast(t.icao)})),"serviceWorker"in navigator&&navigator.serviceWorker.register("./service-worker.js").then(function(){console.log("Service Worker Registered")})}();